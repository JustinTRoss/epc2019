{"version":3,"sources":["config.js","components/common.js","components/MapComponent.js","components/QuestionHeader.js","components/Slider.js","components/steps/LiveAreas.js","components/steps/Demographic.js","components/App.js","serviceWorker.js","index.js"],"names":["loaderOptions","url","poiRenderer","type","symbol","style","color","size","outline","width","visualVariables","field","legendOptions","title","minSize","maxSize","minDataValue","maxDataValue","highlightOptions","fillOpacity","sumStops","value","label","getBlockCountRenderer","time","arguments","length","undefined","defaultRenderer","stops","opcVV","v","gap","steps","push","opacity","showLegend","getTimeOpcStops","getBlockDenseRenderer","mapView","selected","referenceDotValue","referenceScale","scale","unit","attributes","valueExpression","getTimeFilter","where","concat","Math","round","getBlockHlFilter","highlight","MapComponent","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","viewRef","React","createRef","view","_onViewLoaded","bind","assertThisInitialized","_handleMapPointer","_handleClick","state","selPoi","_this2","loadModules","then","_ref","_ref2","slicedToArray","Map","MapView","FeatureLayer","Legend","map","basemap","container","current","center","zoom","constraints","snapToZoom","ui","move","popup","actions","blockLyr","renderer","outFields","poiLyr","addMany","legend","layerInfos","layer","layout","add","vP","when","_","blockDenseLyr","console","log","JSON","stringify","toJSON","whenLayerView","catch","er","bP","pP","Promise","all","evt","_this3","hitTestPromise","cancel","hitTest","hit","res","results","filter","r","graphic","_this4","active","explore","stopPropagation","_handleEvt","poi","remove","onPoiChange","poiLV","_this5","visible","denseLV","getBlockTimeHlFilter","lyrView","effect","insideEffect","outsideEffect","getBlockHlEffect","_ref4","_ref3","lV","onLoad","_setFilters","on","_initMap","react_default","a","createElement","height","backgroundColor","ref","PureComponent","ExtendedButton","styled","Button","_templateObject","QuestionHeader","index","onClick","className","key","white","clearWhite","extraSmall","MySlider","minMax","disabled","defaultTitle","leftLabel","rightLabel","onSlide","float","marginTop","Slider_default","display","min","max","onChange","InfText","CalciteH4","LiveAreas_templateObject","H","CalciteH3","_templateObject2","ExpBtn","_templateObject3","LiveAreas","text","textAlign","fontWeight","getMonthFromTime","large","icon","PinIcon_default","filled","components_Slider","labels","Demographic_templateObject","Demographic_templateObject2","statQuery","onStatisticField","outStatisticFieldName","statisticType","getQuery","wpoi","wtime","groupByFieldsForStatistics","outStatistics","Demographic","lyr","data","selIndex","_onBarClick","features","total","reduce","p","f","wt_sum","vs","TLIFENAME","UA","EE","NW","O","q","queryFeatures","setState","_getChartData","prevProps","prevState","_updateChart","elems","l","_index","queryObjectIds","datasets","fill","Demographic_InfText","Demographic_ExpBtn","GraphBarIcon_default","es","options","scales","xAxes","stacked","scaleLabel","labelString","ticks","autoSkip","minRotation","maxRotation","padding","yAxes","getElementAtEvent","initState","App","onViewLoad","onListItemClick","_onExploreClick","_onTimeSlide","_onPoiChange","loaded","selText","blockLyrView","qKey","next","i","val","fV","parseFloat","target","isActive","components_QuestionHeader","header","getQuestionHeader","Fragment","steps_LiveAreas","steps_Demographic","components_MapComponent","position","top","left","maxHeight","overflowY","getStepOne","getStepTwo","Component","Boolean","window","location","hostname","match","loadCss","defaults","global","defaultFontColor","tooltips","enabled","events","ReactDOM","render","CalciteThemeProvider_default","components_App","document","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.95ccbbcc.chunk.js","sourcesContent":["\n\nconst loaderOptions = {\n  url: 'https://jsdev.arcgis.com/4.12/'\n}\n\nconst poiRenderer = {\n  type: \"simple\",\n  symbol: {\n    type: \"simple-marker\",  // autocasts as new SimpleMarkerSymbol()\n    style: \"diamond\",\n    // color: [0, 171, 189],\n    // color: \"#8AC927\",\n    // color: \"#B0DB43\",\n    color: \"40F99B\",\n    // color: \"#8AC926\" ,\n    // color: [106,255,0],\n    // color: [0, 162, 180],\n    size: \"17px\",  // pixels\n    outline: {  // autocasts as new SimpleLineSymbol()\n      // color: [ 0, 0, 0 ],\n      // color: [0,128,79],\n      color: \"#004D30\",\n      width: 1.5 // points\n    }\n  },\n  visualVariables: [{\n    type: \"size\",\n    field: \"raw_visit_counts\",\n    legendOptions: {title: \"Visit Counts\"},\n    minSize: 4,\n    maxSize: 30,\n    minDataValue: 2000,\n    maxDataValue: 8000\n  }]\n\n}\n\nconst highlightOptions = {\n  color: \"#ffffff\",\n  fillOpacity: 0.17\n}\n\n\n\nexport {loaderOptions, poiRenderer, highlightOptions}","const getMonthFromTime = (time) => {\n  switch(time) {\n    case 0:\n      return \"Sep 2018\"\n    case 1:\n      return \"Oct 2018\"\n    case 2:\n      return \"Nov 2018\"\n    case 3:\n      return \"Dec 2018\"\n    case 4:\n      return \"Jan 2019\"\n    default:\n      return \"Jan 2019\"\n  }\n}\n\nconst sumStops = [\n  {\"value\":25,\"color\":[214,193,215,255],\"label\":\"\\u003c 25\"},\n  {\"value\":20,\"color\":[215,181,216,255],\"label\":null},\n  {\"value\":15,\"color\":[223,101,176,255],\"label\":\"15\"},\n  {\"value\":10,\"color\":[221,28,119,200],\"label\":null},\n  {\"value\":5,\"color\":[152,0,67,200],\"label\":\"\\u003e 5\"}\n]\n\nconst getTimeOpcStops = (v, gap) => {\n  let steps = [];\n  if(v - gap >= 0) {\n    steps.push({\n      opacity: 0.0,\n      value: v - gap,\n      // label: timeStrFromQuarter(v - gap)\n    })\n  }\n  steps.push({\n    opacity: 1,\n    value: v,\n    // label: timeStrFromQuarter(v)\n  })\n  if(v + gap <= 12){\n    steps.push({\n      opacity: 0.0,\n      value: v + gap,\n      // label: timeStrFromQuarter(v + gap)\n    })\n  }\n  return {\n    type: 'opacity',\n    field: 'time',\n    stops: steps,\n    legendOptions: {showLegend: false}\n  }\n}\n\nconst getBlockCountRenderer = (time=12) => {\n  const defaultRenderer = {\n    type: \"simple\",\n    symbol: {type: \"simple-fill\", outline: {width: 0.1, color: [255,255,255,0.2]}, size: 4, color: 'rgba(255,255,255,0)'},\n    visualVariables: [{\n      type: \"color\",\n      field: \"count_\",\n      stops: sumStops,\n      legendOptions: {title: \"Visit Counts\"}\n    }],\n  }\n  if(!time) return defaultRenderer;\n  const opcVV = getTimeOpcStops(time, 1);\n  defaultRenderer.visualVariables.push(opcVV);\n  return defaultRenderer;\n}\n\nconst getBlockDenseRenderer = (mapView, selected=null) => {\n  return {\n    type: \"dot-density\",\n    referenceDotValue: 35,\n    outline: null,\n    referenceScale: mapView.scale,\n    legendOptions: {\n      unit: \"visits\"\n    },\n    attributes: [{\n      valueExpression: '100 * IIf($feature.TLIFENAME == \"Next Wave\", $feature.count_, 0)',\n      label: \"Next Wave\",\n      color: (selected && selected !== \"Next Wave\") ? [227, 69, 143, 0.2] : [227, 69, 143, 1] //dark pink\n    }, {\n      valueExpression: '100 * IIf($feature.TLIFENAME == \"Upscale Avenues\", $feature.count_, 0)',\n      label: \"Upscale Avenues\",\n      color: (selected && selected !== \"Upscale Avenues\") ? [192, 76, 253, 0.2] : [192, 76, 253, 1] // dark purple\n      // color: \"#5E2BFF\" // dark blue\n    }, {\n      valueExpression: '100 * IIf($feature.TLIFENAME == \"Ethnic Enclaves\", $feature.count_, 0)',\n      label: \"Ethnic Enclaves\",\n      color: (selected && selected !== \"Ethnic Enclaves\") ? [239, 131, 84, 0.2] : [239, 131, 84, 1]\n    }, {\n      valueExpression: '100 * IIf(IndexOf([\"Upscale Avenues\", \"Ethnic Enclaves\", \"Next Wave\"], $feature.TLIFENAME) < 0, $feature.count_, 0)',\n      label: \"Other\",\n      color: (selected && selected !== \"Other\") ? [94, 43, 255, 0.2] : [94, 43, 255, 1]\n    }]\n  }\n}\n\nconst getTimeFilter = (time=12) => {\n  return {\n    where: `time = ${Math.round(time)}`\n  }\n}\n\nconst getBlockHlFilter = (highlight=null) => {\n  const where = highlight\n    ? `safegraph_place_id = 'sum' OR safegraph_place_id = '${highlight}'`\n    : `safegraph_place_id = 'sum'`;\n  return {\n    where\n  }\n}\n\nconst getBlockTimeHlFilter = (highlight, time) => {\n  const where = `${getTimeFilter(time).where} AND (${getBlockHlFilter(highlight).where})`\n  return {\n    where: where\n  }\n}\n\nconst getBlockHlEffect = (highlight=null) => {\n\n  if(!highlight) return null;\n\n  return {\n    filter: {\n      where: `safegraph_place_id = '${highlight}'`\n    },\n    insideEffect: \"contrast(1.5)\",\n    outsideEffect: \"grayscale(0.5) opacity(60%) contrast(30%)\"\n  }\n}\n\nconst hideFilter = {\n  where: `safegraph_place_id = 'note here'`\n}\n\nexport{getMonthFromTime, getBlockCountRenderer, getBlockDenseRenderer,\ngetTimeFilter, getBlockHlFilter, getBlockHlEffect, getBlockTimeHlFilter, hideFilter}","import React, {PureComponent} from 'react';\nimport { loadModules } from 'esri-loader';\nimport { loaderOptions, poiRenderer, highlightOptions } from '../config';\nimport { getBlockCountRenderer, getTimeFilter, getBlockDenseRenderer,\n        getBlockHlFilter, getBlockHlEffect, getBlockTimeHlFilter,\n      } from './common'\n\nclass MapComponent extends PureComponent {\n\n  constructor(props){\n    super(props);\n    this.viewRef = React.createRef();\n    this.view = null;\n    this._onViewLoaded = this._onViewLoaded.bind(this);\n    this._handleMapPointer = this._handleMapPointer.bind(this);\n    this._handleClick = this._handleClick.bind(this);\n    this.state = {\n      selPoi: null\n    }\n  }\n\n  _initMap(){\n    loadModules(['esri/Map', 'esri/views/MapView',\n                'esri/layers/FeatureLayer', 'esri/widgets/Legend'], loaderOptions)\n      .then(([Map, MapView, FeatureLayer, Legend]) => {\n        this.map = new Map({\n          basemap: 'dark-gray-vector'\n        })\n\n        this.view = new MapView({\n          map: this.map,\n          container: this.viewRef.current,\n          // center: [-118.34619, 33.95831],\n          center: [-118.26970988458462, 33.93696960332196],\n          zoom: 9.75,\n          constraints: {\n            snapToZoom: false\n          },\n          highlightOptions: highlightOptions\n        })\n        this.view.ui.move('zoom', 'top-right')\n        this.view.popup.actions = [];\n\n        this.blockLyr = new FeatureLayer({\n          url: \"https://services.arcgis.com/q7zPNeKmTWeh7Aor/arcgis/rest/services/sg_ca_top_block_long_enriched_simp/FeatureServer\",\n          renderer: getBlockCountRenderer(),\n          outFields: [\"safegraph_place_id\", \"count_\", \"time\"]\n        });\n\n        this.poiLyr = new FeatureLayer({\n          url: \"https://services.arcgis.com/q7zPNeKmTWeh7Aor/arcgis/rest/services/a07272/FeatureServer\",\n          outFields: [\"safegraph_place_id\", \"raw_visit_counts\", \"time\", \"location_name\"],\n          renderer: poiRenderer\n        })\n        this.map.addMany([this.blockLyr, this.poiLyr]);\n        \n        const legend = new Legend({\n          view: this.view,\n          layerInfos: [{\n            layer: this.blockLyr,\n            title: \"Census Blocks\"\n          }, {\n            layer: this.poiLyr,\n            title: \"Stores\"\n          }],\n          style: {\n            layout: \"stack\"\n          }\n        })\n        this.view.ui.add(legend, 'bottom-right');\n\n        const vP = this.view.when()\n          .then(_ => {\n            this.blockDenseLyr = new FeatureLayer({\n              url: \"https://services.arcgis.com/q7zPNeKmTWeh7Aor/arcgis/rest/services/sg_ca_top_block_long_enriched_simp/FeatureServer\",\n              renderer: getBlockDenseRenderer(this.view),\n              outFields: [\"safegraph_place_id\", \"count_\", \"time\", \"TLIFENAME\"]\n            });\n            this.map.add(this.blockDenseLyr, 0);\n            legend.layerInfos.push({\n              layer: this.blockDenseLyr,\n              title: \"Census Blocks\"\n            })\n            console.log(JSON.stringify(this.poiLyr.renderer.toJSON()));\n            console.log(JSON.stringify(this.blockLyr.renderer.toJSON()));\n            return this.view.whenLayerView(this.blockDenseLyr);\n          })\n          .catch(er => console.log(er));\n\n        const bP = this.view.whenLayerView(this.blockLyr);\n        const pP = this.view.whenLayerView(this.poiLyr);\n        Promise.all([bP, pP, vP]).then(this._onViewLoaded);\n      \n      })\n      .catch(er => console.log(er));\n  }\n\n  _handleEvt(evt){\n    if(this.hitTestPromise){\n      this.hitTestPromise.cancel();\n    }\n    this.hitTestPromise = this.view.hitTest(evt)\n      .then(hit => {\n        this.hitTestPromise = null;\n        let res = hit.results.filter(r => r.graphic.layer === this.poiLyr);\n        if(res.length){\n          return(res[0].graphic);\n        } else if(this.state.selPoi){\n          return null;\n        }\n      })\n    return this.hitTestPromise;\n  }\n\n  _handleClick(evt){\n    if(!this.props.active[0] || this.props.explore) return;\n    evt.stopPropagation();\n    this._handleEvt(evt, false).then(poi => {\n      if(this.highlight) this.highlight.remove();\n      if(poi){\n        this.props.onPoiChange(poi.attributes['safegraph_place_id'], poi.attributes['location_name']);\n        this.highlight = this.poiLV.highlight(poi);\n      } else {\n        this.props.onPoiChange(null);\n      }\n    })\n  }\n\n  _handleMapPointer(evt){\n    if(!this.props.active[0] || !this.props.explore) return;\n    this._handleEvt(evt, false).then(poi => {\n      if(this.highlight) this.highlight.remove();\n      if(poi){\n        this.props.onPoiChange(poi.attributes['safegraph_place_id'], poi.attributes['location_name']);\n        this.highlight = this.poiLV.highlight(poi);\n      } else {\n        this.props.onPoiChange(null);\n      }\n    })\n  }\n\n  _setFilters(poi=null, time=null){\n    if(this.props.active[1]){\n      \n      this.blockDenseLyr.visible = true;\n      this.blockLyr.visible = false;\n      this.denseLV.filter = getBlockTimeHlFilter(poi, time);\n    } else {\n\n      this.blockDenseLyr.visible = false;\n      this.blockLyr.visible = true;\n\n      this.lyrView.filter = getBlockHlFilter(poi, time);\n      this.blockLyr.renderer = getBlockCountRenderer(time);\n      this.lyrView.effect = getBlockHlEffect(poi);\n      \n    }\n    this.poiLV.filter = getTimeFilter(time);\n  }\n\n  _onViewLoaded([lV, poiLV, denseLV]){\n    this.props.onLoad(this.map, this.view, this.blockDenseLyr, denseLV);\n    this.lyrView = lV;\n    this.poiLV = poiLV;\n    this.denseLV = denseLV;\n    \n    this._setFilters(this.props.poi, this.props.time);\n\n    this.view.on(\"pointer-move\", this._handleMapPointer);\n    this.view.on(\"click\", this._handleClick);\n\n  }\n\n  componentDidMount(){\n    this._initMap();\n  }\n\n  // doesn't update to dot-density when switched\n  render(){\n    if(this.lyrView){\n      this._setFilters(this.props.poi, this.props.time);\n\n    }\n\n    return(\n      <div style={{width: \"100vw\", height: \"100vh\", backgroundColor: \"#373938\"}} ref={this.viewRef}/>\n    )\n  }\n\n}\n\nexport default MapComponent;","import React from 'react';\nimport Button from 'calcite-react/Button';\nimport './question.css'\nimport styled, { css } from 'styled-components';\n\nconst ExtendedButton = styled(Button)`\n  width: 2.5rem;\n  height: 2.5rem;\n  border-radius: 50%;\n  margin: 0.5rem;\n  font-size: 1.69949rem;\n  line-height: 2.325rem;\n`;\n\n\n\nfunction QuestionHeader({title, index, onClick, active}){\n  \n  const className = active ? 'question-panel-active' : 'question-panel';\n  return(\n    <div key={title} style={{color: 'white'}} className={className}>\n      <ExtendedButton\n        white={active}\n        clearWhite={!active}\n        extraSmall\n        onClick={onClick}>\n        {index + 1}\n      </ExtendedButton>\n      {title}\n    </div>\n  )\n\n}\nexport default QuestionHeader;","import React from 'react';\nimport Slider from 'calcite-react/Slider';\n\nfunction MySlider({value, active, disabled, title, defaultTitle, minMax,\n  leftLabel, rightLabel, onClick, onSlide}) {\n    \n  const slider = active ? (\n    <div>\n    <div style={{float: 'left', width: '75px', marginTop: '5px'}}>{leftLabel}</div>\n      <Slider\n        style={{display: 'inline-block', width: 'calc(100% - 160px)'}}\n        min={minMax[0]}\n        max={minMax[1]}\n        value={value}\n        onChange={onSlide}\n      />\n    <div style={{float: 'right', width: '75px', marginTop:'5px'}}>{rightLabel}</div>\n    </div>\n  )\n  : null;\n  return slider;\n}\n\n// 106 255 0 --  darker version (pull V down)\n\nexport default MySlider","import React from 'react';\nimport { CalciteH4, CalciteH3 } from 'calcite-react/Elements';\nimport {getMonthFromTime} from '../common';\nimport styled, { css } from 'styled-components';\nimport Button from 'calcite-react/Button';\nimport Slider from '../Slider';\nimport PinIcon from 'calcite-ui-icons-react/PinIcon';\n\n\nconst InfText = styled(CalciteH4)`\n  color: white;\n  float: left;\n  width: calc(50% - 1rem);\n  margin: 0;\n  padding: 0.5rem;\n`\nconst H = styled(CalciteH3)`\n  color: white;\n  margin: 0;\n  padding: 0.25rem 0rem 0rem 0.5rem;\n`\nconst ExpBtn = styled(Button)`\n  border: None;\n  width: 7rem;\n  margin-left: calc(50% - 7rem);\n  padding-right: 0;\n`\n\nconst LiveAreas = ({active, onClick, value, onSlide, text}) => (\n  \n\n  <div style={{textAlign: \"center\"}}>\n    <div style={{textAlign: \"left\", width: \"100%\"}}>\n      <H style={{fontWeight: 'bold'}}>{text ? text : 'All'}</H>\n      <InfText>{`${getMonthFromTime(Math.round(value/4))}`}</InfText>\n      <ExpBtn\n        clearWhite\n        large\n        icon={<PinIcon filled={active}/>}\n        onClick={onClick}>\n        Explore\n      </ExpBtn>\n    </div>\n    <Slider\n      value={value}\n      active\n      minMax={[1,16]}\n      defaultTitle={'All day'}\n      leftLabel={\"Sep 2018\"}\n      rightLabel={\"Jan 2019\"}\n      onSlide={onSlide}\n    />\n  </div>\n)\nexport default LiveAreas;","import React, {PureComponent} from 'react';\nimport {Bar } from 'react-chartjs-2';\nimport { CalciteH4 } from 'calcite-react/Elements';\nimport Button from 'calcite-react/Button';\nimport styled, { css } from 'styled-components';\nimport GraphBarIcon from 'calcite-ui-icons-react/GraphBarIcon';\nimport {getBlockDenseRenderer} from '../common';\n\nconst labels = ['Next Wave', 'Upscale Avenues', 'Ethnic Enclaves', 'Other'];\n\nconst InfText = styled(CalciteH4)`\n  color: white;\n  float: left;\n  width: calc(50% - 1rem);\n  margin: 0;\n  padding: 0.5rem;\n`\nconst ExpBtn = styled(Button)`\n  border: None;\n  width: 8rem;\n  margin-left: calc(50% - 8rem);\n  padding-right: 0;\n`\nconst statQuery = {\n  onStatisticField: `count_`,\n  outStatisticFieldName: `wt_sum`,\n  statisticType: 'sum'\n}\n\n// const statQuery = query.groupByFieldsForStatistics = [ \"region\" ];\n\n// let statQueries = fields.map(f => ({\n//   onStatisticField: `count_`,\n//   outStatisticFieldName: `wt_sum`,\n//   statisticType: 'sum'\n// }))\n// statQueries.push({\n//   onStatisticField: 'count',\n//   outStatisticFieldName: 'countsum',\n//   statisticType: 'sum'\n// })\n\nconst getQuery = (time, poi=null) => {\n  const wpoi = poi\n    ? `safegraph_place_id = '${poi}'`\n    : `safegraph_place_id = 'sum'`;\n  const wtime = `time = ${Math.round(time)}`;\n  const w = `${wpoi} AND ${wtime}`;\n  return {\n    where: w,\n    groupByFieldsForStatistics: 'TLIFENAME',\n    outStatistics: statQuery\n  }\n}\n\n\nclass Demographic extends PureComponent {\n  constructor(props){\n    super(props);\n    this.lyr = props.lyr;\n    this.lyrView = props.lyrView;\n    this.mapView = props.mapView;\n    this.state = {\n      data: [],\n      selIndex: null,\n    }\n    this._onBarClick = this._onBarClick.bind(this);\n  }\n\n  _getChartData(res){\n    if(!res || !res.features || !res.features.length) return [];\n    \n    const total = res.features.reduce( (p, f) => {\n      if(!f.attributes.wt_sum) return p;\n      return p + f.attributes.wt_sum;\n    }, 0);\n\n\n    const vs = res.features.reduce( (p, f) => {\n      if(!f.attributes.wt_sum || !f.attributes.TLIFENAME) return p;\n      if(f.attributes.TLIFENAME === 'Upscale Avenues'){\n        p['UA'] += f.attributes.wt_sum / total;\n      } else if (f.attributes.TLIFENAME === 'Ethnic Enclaves'){\n        p['EE'] += f.attributes.wt_sum / total;\n      } else if (f.attributes.TLIFENAME === 'Next Wave'){\n        p['NW'] += f.attributes.wt_sum / total;\n      } else {\n        p['O'] += f.attributes.wt_sum / total;\n      }\n      return p;\n    }, {\n      'UA': 0,\n      'EE': 0,\n      'NW': 0,\n      'O' : 0\n    });\n    \n    return ([\n      vs['NW'],\n      vs['UA'],\n      vs['EE'],\n      vs['O']\n    ])\n\n  }\n\n\n  componentDidMount(){\n\n    const q = getQuery(this.props.time, this.props.poi);\n\n    this.lyr.queryFeatures(q)\n      .then(res => {\n        // console.log(this._getChartData(res));\n        // console.log(res.features[0].attributes)\n        this.setState({\n          data: this._getChartData(res)\n        })\n      })\n      .catch(er => console.log(er));\n  }\n\n  componentDidUpdate(prevProps, prevState){\n    if(prevProps.poi !== this.props.poi || prevProps.time !== this.props.time){\n      this._updateChart()\n    }\n  }\n\n  _onBarClick(elems){\n    if(elems.length > 0){\n      const l = labels[elems[0]._index];\n      this.lyr.renderer = getBlockDenseRenderer(this.mapView, l);\n      this.setState({selIndex: elems[0]._index});\n    } else {\n      this.lyr.renderer = getBlockDenseRenderer(this.mapView);\n      this.setState({selIndex: null});\n    }\n  }\n\n  _updateChart(){\n    const q = getQuery(this.props.time, this.props.poi);\n    this.lyrView.queryFeatures(q)\n      .then(res => {\n        this.setState({\n          data: this._getChartData(res)\n        })\n      })\n      .catch(er => console.log(er))\n\n\n    if(this.highlight){\n      this.highlight.remove();\n    }\n\n    if(this.props.poi){\n      this.lyrView.queryObjectIds(q)\n        .then(res => {\n          this.highlight = this.lyrView.highlight(res)\n        })\n        .catch(er => console.log(er))\n    }\n    \n  }\n\n  render(){\n\n    let backgroundColor = [\n      \"rgba(227,69,143, 0.7)\",\n      \"rgba(192,76,253, 0.7)\",\n      \"rgba(239,131,85, 0.7)\",\n      \"rgba(94, 43, 255, 0.7)\",\n    ]\n    // if(this.state.selIndex !== null){\n    //   backgroundColor = backgroundColor.map((b,i) => \n    //     i === this.state.selIndex ? b : b.replace('0.7', '0.2')\n    //   )\n    // }\n\n    const data = {\n      labels,\n      datasets: [{\n        label: \"Pattern\",\n        fill: false,\n        data: this.state.data,\n        backgroundColor\n      }]\n    }\n\n    return(\n      <div style={{textAlign: \"center\"}}>\n        <div style={{textAlign: \"left\", width: \"100%\"}}>\n          <InfText>Tapestry Profile</InfText>\n          <ExpBtn\n            clearWhite\n            large\n            icon={<GraphBarIcon filled={this.props.active}/>}\n            onClick={this.props.onClick}>\n            Compare\n          </ExpBtn>\n        </div>\n        <Bar\n          data={data}\n          height={250}\n          options={{\n            scales: {\n              xAxes: [{\n                display: true,\n                stacked: true,\n                scaleLabel: {\n                  display: true,\n                  labelString: 'Tapestry Life Mode'\n                },\n                ticks: {\n                  autoSkip: false,\n                  minRotation: 30,\n                  maxRotation: 30,\n                  padding: 0\n                }\n              }],\n              yAxes: [{\n                display: true,\n                stacked: true,\n                scaleLabel: {\n                  display: true,\n                  labelString: 'Fraction'\n                },\n                ticks: {\n                  max: 1\n                }\n              }]\n            }\n          }}\n          getElementAtEvent={this._onBarClick}\n        />\n      </div>\n    )\n  }\n\n}\n\nexport default Demographic;","import React, {Component} from 'react';\nimport MapComponent from './MapComponent';\nimport QuestionHeader from './QuestionHeader';\nimport LiveAreas from './steps/LiveAreas';\nimport Demographic from './steps/Demographic';\nimport './question.css';\n\nconst initState = [true, false, false];\n\nclass App extends Component{\n\n  constructor(props){\n    super(props);\n    this.onViewLoad = this.onViewLoad.bind(this);\n    this.onListItemClick = this.onListItemClick.bind(this);\n    this._onExploreClick = this._onExploreClick.bind(this);\n    this._onTimeSlide = this._onTimeSlide.bind(this);\n    this._onPoiChange = this._onPoiChange.bind(this);\n    this.state = {\n      loaded: false,\n      active: [false, false, false],\n      explore: true,\n      selPoi: null,\n      selText: null,\n      time: 16\n    }\n  }\n\n  onViewLoad (map, view, blockLyr, blockLyrView){\n    this.mapView = view;\n    this.blockLyr = blockLyr;\n    this.blockLyrView = blockLyrView;\n    this.setState({\n      loaded: true,\n      active: initState\n    })\n  }\n\n  onListItemClick(qKey){\n\n    const next = this.state.active.map( (v,i) => \n      i === qKey ? !v : v\n    )\n\n    this.setState({\n      active: next\n    })\n  }\n\n  _onExploreClick(){\n    this.setState({\n      explore: !this.state.explore\n    })\n  }\n\n  _onTimeSlide(val){\n    let fV = parseFloat(val.target.value);\n    this.setState({\n      time: fV\n    })\n  }\n\n  _onPoiChange(poi, text){\n    this.setState({selPoi: poi, selText: text})\n  }\n\n\n  getQuestionHeader(v, i){\n    const isActive = this.state.active[i];\n    return (<QuestionHeader\n      title={v}\n      onClick={_=>this.onListItemClick(i)} // not good pattern\n      active={isActive}\n      index={i}\n    />)\n  }\n\n  getStepOne(){\n    let header = this.getQuestionHeader('SafeGraph Patterns', 0);\n    if(!this.state.active[0]){\n      return header;\n    }\n    return (\n      <>\n        {header}\n        <div className=\"question-content\">\n          <LiveAreas\n            active={this.state.explore}\n            onClick={this._onExploreClick}\n            value={this.state.time}\n            onSlide={this._onTimeSlide}\n            text={this.state.selText}/>\n        </div>\n      </>\n    )\n  }\n\n  getStepTwo(){\n    let header = this.getQuestionHeader('With Tapestry Segments', 1);\n    if(!this.state.active[1]){\n      return header;\n    }\n    return (\n      <>\n        {header}\n        <div className=\"question-content\">\n          <Demographic\n            lyr={this.blockLyr}\n            lyrView={this.blockLyrView}\n            mapView={this.mapView}\n            time={this.state.time / 4}\n            poi={this.state.selPoi}\n          />\n        </div>\n      </>\n    )\n  }\n\n  render(){\n    return(\n      <div>\n        <MapComponent\n          map={this.map}\n          onLoad={this.onViewLoad}\n          active={this.state.active}\n          explore={this.state.explore}\n          time={this.state.time / 4}\n          poi={this.state.selPoi}\n          onPoiChange={this._onPoiChange}\n        />\n        <div style={{position: \"absolute\", top: 15, left: 15, width: \"30%\", maxHeight: 'calc(100vh - 20px)', overflowY: 'scroll'}}>\n          <div style={{}}>\n            {this.getStepOne()}\n            {this.getStepTwo()}\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n}\n\nexport default App\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './components/App';\nimport * as serviceWorker from './serviceWorker';\nimport CalciteThemeProvider from 'calcite-react/CalciteThemeProvider';\nimport { defaults } from 'react-chartjs-2';\nimport { loadCss } from 'esri-loader';\nimport './index.css';\n\nloadCss(\"https://jsdev.arcgis.com/4.12/esri/themes/dark/main.css\");\n\n\ndefaults.global.defaultFontColor = '#ffffff';\ndefaults.global.legend = false;\ndefaults.global.tooltips.enabled = false;\ndefaults.global.events = ['click', 'touchstart', 'touchend'];\n// defaults.global.legend.fontColor = '#ffffff';\n\nReactDOM.render(\n  <CalciteThemeProvider>\n    <App/>\n  </CalciteThemeProvider>,\n  document.getElementById(\"root\")\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}