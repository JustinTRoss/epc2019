(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{243:function(e,t,i){},244:function(e,t,i){"use strict";i.r(t);var a=i(0),n=i.n(a),r=i(39),l=i.n(r),o=i(14),s=i(15),c=i(19),u=i(16),h=i(5),p=i(18),d=i(53),v=i(40),m={url:"https://jsdev.arcgis.com/4.11/"},f={type:"simple",symbol:{type:"simple-marker",style:"diamond",color:"40F99B",size:"17px",outline:{color:"#004D30",width:1.5}},visualVariables:[{type:"size",field:"raw_visit_counts",legendOptions:{title:"Visit Counts"},minSize:4,maxSize:30,minDataValue:2e3,maxDataValue:8e3}]},g={color:"#ffffff",fillOpacity:.17},b=[{value:25,color:[214,193,215,255],label:"< 25"},{value:20,color:[215,181,216,255],label:null},{value:15,color:[223,101,176,255],label:"15"},{value:10,color:[221,28,119,200],label:null},{value:5,color:[152,0,67,200],label:"> 5"}],y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,t={type:"simple",symbol:{type:"simple-fill",outline:{width:.1,color:[255,255,255,.2]},size:4,color:"rgba(255,255,255,0)"},visualVariables:[{type:"color",field:"count_",stops:b,legendOptions:{title:"Visit Counts"}}]};if(!e)return t;var i=function(e,t){var i=[];return e-t>=0&&i.push({opacity:0,value:e-t}),i.push({opacity:1,value:e}),e+t<=12&&i.push({opacity:0,value:e+t}),{type:"opacity",field:"time",stops:i,legendOptions:{showLegend:!1}}}(e,1);return t.visualVariables.push(i),t},w=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return{type:"dot-density",referenceDotValue:35,outline:null,referenceScale:e.scale,legendOptions:{unit:"visits"},attributes:[{valueExpression:'100 * IIf($feature.TLIFENAME == "Next Wave", $feature.count_, 0)',label:"Next Wave",color:t&&"Next Wave"!==t?[227,69,143,.2]:[227,69,143,1]},{valueExpression:'100 * IIf($feature.TLIFENAME == "Upscale Avenues", $feature.count_, 0)',label:"Upscale Avenues",color:t&&"Upscale Avenues"!==t?[192,76,253,.2]:[192,76,253,1]},{valueExpression:'100 * IIf($feature.TLIFENAME == "Ethnic Enclaves", $feature.count_, 0)',label:"Ethnic Enclaves",color:t&&"Ethnic Enclaves"!==t?[239,131,84,.2]:[239,131,84,1]},{valueExpression:'100 * IIf(IndexOf(["Upscale Avenues", "Ethnic Enclaves", "Next Wave"], $feature.TLIFENAME) < 0, $feature.count_, 0)',label:"Other",color:t&&"Other"!==t?[94,43,255,.2]:[94,43,255,1]}]}},_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;return{where:"time = ".concat(Math.round(e))}},k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return{where:e?"safegraph_place_id = 'sum' OR safegraph_place_id = '".concat(e,"'"):"safegraph_place_id = 'sum'"}},E=function(e){function t(e){var i;return Object(o.a)(this,t),(i=Object(c.a)(this,Object(u.a)(t).call(this,e))).viewRef=n.a.createRef(),i.view=null,i._onViewLoaded=i._onViewLoaded.bind(Object(h.a)(i)),i._handleMapPointer=i._handleMapPointer.bind(Object(h.a)(i)),i._handleClick=i._handleClick.bind(Object(h.a)(i)),i.state={selPoi:null},i}return Object(p.a)(t,e),Object(s.a)(t,[{key:"_initMap",value:function(){var e=this;Object(v.loadModules)(["esri/Map","esri/views/MapView","esri/layers/FeatureLayer","esri/widgets/Legend"],m).then(function(t){var i=Object(d.a)(t,4),a=i[0],n=i[1],r=i[2],l=i[3];e.map=new a({basemap:"dark-gray-vector"}),e.view=new n({map:e.map,container:e.viewRef.current,center:[-118.26970988458461,33.93696960332196],zoom:9.75,constraints:{snapToZoom:!1},highlightOptions:g}),e.view.ui.move("zoom","top-right"),e.view.popup.actions=[],e.blockLyr=new r({url:"https://services.arcgis.com/q7zPNeKmTWeh7Aor/arcgis/rest/services/sg_ca_top_block_long_enriched_simp/FeatureServer",renderer:y(),outFields:["safegraph_place_id","count_","time"]}),e.poiLyr=new r({url:"https://services.arcgis.com/q7zPNeKmTWeh7Aor/arcgis/rest/services/a07272/FeatureServer",outFields:["safegraph_place_id","raw_visit_counts","time","location_name"],renderer:f}),e.map.addMany([e.blockLyr,e.poiLyr]);var o=new l({view:e.view,layerInfos:[{layer:e.blockLyr,title:"Census Blocks"},{layer:e.poiLyr,title:"Stores"}],style:{layout:"stack"}});e.view.ui.add(o,"bottom-right");var s=e.view.when().then(function(t){return e.blockDenseLyr=new r({url:"https://services.arcgis.com/q7zPNeKmTWeh7Aor/arcgis/rest/services/sg_ca_top_block_long_enriched_simp/FeatureServer",renderer:w(e.view),outFields:["safegraph_place_id","count_","time","TLIFENAME"]}),e.map.add(e.blockDenseLyr,0),o.layerInfos.push({layer:e.blockDenseLyr,title:"Census Blocks"}),console.log(JSON.stringify(e.poiLyr.renderer.toJSON())),console.log(JSON.stringify(e.blockLyr.renderer.toJSON())),e.view.whenLayerView(e.blockDenseLyr)}).catch(function(e){return console.log(e)}),c=e.view.whenLayerView(e.blockLyr),u=e.view.whenLayerView(e.poiLyr);Promise.all([c,u,s]).then(e._onViewLoaded)}).catch(function(e){return console.log(e)})}},{key:"_handleEvt",value:function(e){var t=this;return this.hitTestPromise&&this.hitTestPromise.cancel(),this.hitTestPromise=this.view.hitTest(e).then(function(e){t.hitTestPromise=null;var i=e.results.filter(function(e){return e.graphic.layer===t.poiLyr});return i.length?i[0].graphic:t.state.selPoi?null:void 0}),this.hitTestPromise}},{key:"_handleClick",value:function(e){var t=this;this.props.active[0]&&!this.props.explore&&(e.stopPropagation(),this._handleEvt(e,!1).then(function(e){t.highlight&&t.highlight.remove(),e?(t.props.onPoiChange(e.attributes.safegraph_place_id,e.attributes.location_name),t.highlight=t.poiLV.highlight(e)):t.props.onPoiChange(null)}))}},{key:"_handleMapPointer",value:function(e){var t=this;this.props.active[0]&&this.props.explore&&this._handleEvt(e,!1).then(function(e){t.highlight&&t.highlight.remove(),e?(t.props.onPoiChange(e.attributes.safegraph_place_id,e.attributes.location_name),t.highlight=t.poiLV.highlight(e)):t.props.onPoiChange(null)})}},{key:"_setFilters",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.props.active[1]?(this.blockDenseLyr.visible=!0,this.blockLyr.visible=!1,this.denseLV.filter=function(e,t){return{where:"".concat(_(t).where," AND (").concat(k(e).where,")")}}(e,t)):(this.blockDenseLyr.visible=!1,this.blockLyr.visible=!0,this.lyrView.filter=k(e,t),this.blockLyr.renderer=y(t),this.lyrView.effect=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e?{filter:{where:"safegraph_place_id = '".concat(e,"'")},insideEffect:"contrast(1.5)",outsideEffect:"grayscale(0.5) opacity(60%) contrast(30%)"}:null}(e)),this.poiLV.filter=_(t)}},{key:"_onViewLoaded",value:function(e){var t=Object(d.a)(e,3),i=t[0],a=t[1],n=t[2];this.props.onLoad(this.map,this.view,this.blockDenseLyr,n),this.lyrView=i,this.poiLV=a,this.denseLV=n,this._setFilters(this.props.poi,this.props.time),this.view.on("pointer-move",this._handleMapPointer),this.view.on("click",this._handleClick)}},{key:"componentDidMount",value:function(){this._initMap()}},{key:"render",value:function(){return this.lyrView&&this._setFilters(this.props.poi,this.props.time),n.a.createElement("div",{style:{width:"100vw",height:"100vh",backgroundColor:"#373938"},ref:this.viewRef})}}]),t}(a.PureComponent),L=i(9),O=i(17),x=i.n(O),C=(i(61),i(4));function V(){var e=Object(L.a)(["\n  width: 2.5rem;\n  height: 2.5rem;\n  border-radius: 50%;\n  margin: 0.5rem;\n  font-size: 1.69949rem;\n  line-height: 2.325rem;\n"]);return V=function(){return e},e}var S=Object(C.default)(x.a)(V());var j=function(e){var t=e.title,i=e.index,a=e.onClick,r=e.active,l=r?"question-panel-active":"question-panel";return n.a.createElement("div",{key:t,style:{color:"white"},className:l},n.a.createElement(S,{white:r,clearWhite:!r,extraSmall:!0,onClick:a},i+1),t)},T=i(27),N=i(86),P=i.n(N);var A=function(e){var t=e.value,i=e.active,a=(e.disabled,e.title,e.defaultTitle,e.minMax),r=e.leftLabel,l=e.rightLabel,o=(e.onClick,e.onSlide);return i?n.a.createElement("div",null,n.a.createElement("div",{style:{float:"left",width:"75px",marginTop:"5px"}},r),n.a.createElement(P.a,{style:{display:"inline-block",width:"calc(100% - 160px)"},min:a[0],max:a[1],value:t,onChange:o}),n.a.createElement("div",{style:{float:"right",width:"75px",marginTop:"5px"}},l)):null},F=i(87),I=i.n(F);function M(){var e=Object(L.a)(["\n  border: None;\n  width: 7rem;\n  margin-left: calc(50% - 7rem);\n  padding-right: 0;\n"]);return M=function(){return e},e}function D(){var e=Object(L.a)(["\n  color: white;\n  margin: 0;\n  padding: 0.25rem 0rem 0rem 0.5rem;\n"]);return D=function(){return e},e}function W(){var e=Object(L.a)(["\n  color: white;\n  float: left;\n  width: calc(50% - 1rem);\n  margin: 0;\n  padding: 0.5rem;\n"]);return W=function(){return e},e}var z=Object(C.default)(T.CalciteH4)(W()),q=Object(C.default)(T.CalciteH3)(D()),B=Object(C.default)(x.a)(M()),U=function(e){var t=e.active,i=e.onClick,a=e.value,r=e.onSlide,l=e.text;return n.a.createElement("div",{style:{textAlign:"center"}},n.a.createElement("div",{style:{textAlign:"left",width:"100%"}},n.a.createElement(q,{style:{fontWeight:"bold"}},l||"All"),n.a.createElement(z,null,"".concat(function(e){switch(e){case 0:return"Sep 2018";case 1:return"Oct 2018";case 2:return"Nov 2018";case 3:return"Dec 2018";case 4:default:return"Jan 2019"}}(Math.round(a/4)))),n.a.createElement(B,{clearWhite:!0,large:!0,icon:n.a.createElement(I.a,{filled:t}),onClick:i},"Explore")),n.a.createElement(A,{value:a,active:!0,minMax:[1,16],defaultTitle:"All day",leftLabel:"Sep 2018",rightLabel:"Jan 2019",onSlide:r}))},$=i(13),J=i(89),H=i.n(J);function R(){var e=Object(L.a)(["\n  border: None;\n  width: 8rem;\n  margin-left: calc(50% - 8rem);\n  padding-right: 0;\n"]);return R=function(){return e},e}function K(){var e=Object(L.a)(["\n  color: white;\n  float: left;\n  width: calc(50% - 1rem);\n  margin: 0;\n  padding: 0.5rem;\n"]);return K=function(){return e},e}var Q=["Next Wave","Upscale Avenues","Ethnic Enclaves","Other"],G=Object(C.default)(T.CalciteH4)(K()),Y=Object(C.default)(x.a)(R()),Z={onStatisticField:"count_",outStatisticFieldName:"wt_sum",statisticType:"sum"},X=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=t?"safegraph_place_id = '".concat(t,"'"):"safegraph_place_id = 'sum'",a="time = ".concat(Math.round(e));return{where:"".concat(i," AND ").concat(a),groupByFieldsForStatistics:"TLIFENAME",outStatistics:Z}},ee=function(e){function t(e){var i;return Object(o.a)(this,t),(i=Object(c.a)(this,Object(u.a)(t).call(this,e))).lyr=e.lyr,i.lyrView=e.lyrView,i.mapView=e.mapView,i.state={data:[],selIndex:null},i._onBarClick=i._onBarClick.bind(Object(h.a)(i)),i}return Object(p.a)(t,e),Object(s.a)(t,[{key:"_getChartData",value:function(e){if(!e||!e.features||!e.features.length)return[];var t=e.features.reduce(function(e,t){return t.attributes.wt_sum?e+t.attributes.wt_sum:e},0),i=e.features.reduce(function(e,i){return i.attributes.wt_sum&&i.attributes.TLIFENAME?("Upscale Avenues"===i.attributes.TLIFENAME?e.UA+=i.attributes.wt_sum/t:"Ethnic Enclaves"===i.attributes.TLIFENAME?e.EE+=i.attributes.wt_sum/t:"Next Wave"===i.attributes.TLIFENAME?e.NW+=i.attributes.wt_sum/t:e.O+=i.attributes.wt_sum/t,e):e},{UA:0,EE:0,NW:0,O:0});return[i.NW,i.UA,i.EE,i.O]}},{key:"componentDidMount",value:function(){var e=this,t=X(this.props.time,this.props.poi);this.lyr.queryFeatures(t).then(function(t){e.setState({data:e._getChartData(t)})}).catch(function(e){return console.log(e)})}},{key:"componentDidUpdate",value:function(e,t){e.poi===this.props.poi&&e.time===this.props.time||this._updateChart()}},{key:"_onBarClick",value:function(e){if(e.length>0){var t=Q[e[0]._index];this.lyr.renderer=w(this.mapView,t),this.setState({selIndex:e[0]._index})}else this.lyr.renderer=w(this.mapView),this.setState({selIndex:null})}},{key:"_updateChart",value:function(){var e=this,t=X(this.props.time,this.props.poi);this.lyrView.queryFeatures(t).then(function(t){e.setState({data:e._getChartData(t)})}).catch(function(e){return console.log(e)}),this.highlight&&this.highlight.remove(),this.props.poi&&this.lyrView.queryObjectIds(t).then(function(t){e.highlight=e.lyrView.highlight(t)}).catch(function(e){return console.log(e)})}},{key:"render",value:function(){var e={labels:Q,datasets:[{label:"Pattern",fill:!1,data:this.state.data,backgroundColor:["rgba(227,69,143, 0.7)","rgba(192,76,253, 0.7)","rgba(239,131,85, 0.7)","rgba(94, 43, 255, 0.7)"]}]};return n.a.createElement("div",{style:{textAlign:"center"}},n.a.createElement("div",{style:{textAlign:"left",width:"100%"}},n.a.createElement(G,null,"Tapestry Profile"),n.a.createElement(Y,{clearWhite:!0,large:!0,icon:n.a.createElement(H.a,{filled:this.props.active}),onClick:this.props.onClick},"Compare")),n.a.createElement($.a,{data:e,height:250,options:{scales:{xAxes:[{display:!0,stacked:!0,scaleLabel:{display:!0,labelString:"Tapestry Life Mode"},ticks:{autoSkip:!1,minRotation:30,maxRotation:30,padding:0}}],yAxes:[{display:!0,stacked:!0,scaleLabel:{display:!0,labelString:"Fraction"},ticks:{max:1}}]}},getElementAtEvent:this._onBarClick}))}}]),t}(a.PureComponent),te=[!0,!1,!1],ie=function(e){function t(e){var i;return Object(o.a)(this,t),(i=Object(c.a)(this,Object(u.a)(t).call(this,e))).onViewLoad=i.onViewLoad.bind(Object(h.a)(i)),i.onListItemClick=i.onListItemClick.bind(Object(h.a)(i)),i._onExploreClick=i._onExploreClick.bind(Object(h.a)(i)),i._onTimeSlide=i._onTimeSlide.bind(Object(h.a)(i)),i._onPoiChange=i._onPoiChange.bind(Object(h.a)(i)),i.state={loaded:!1,active:[!1,!1,!1],explore:!0,selPoi:null,selText:null,time:16},i}return Object(p.a)(t,e),Object(s.a)(t,[{key:"onViewLoad",value:function(e,t,i,a){this.mapView=t,this.blockLyr=i,this.blockLyrView=a,this.setState({loaded:!0,active:te})}},{key:"onListItemClick",value:function(e){var t=this.state.active.map(function(t,i){return i===e?!t:t});this.setState({active:t})}},{key:"_onExploreClick",value:function(){this.setState({explore:!this.state.explore})}},{key:"_onTimeSlide",value:function(e){var t=parseFloat(e.target.value);this.setState({time:t})}},{key:"_onPoiChange",value:function(e,t){this.setState({selPoi:e,selText:t})}},{key:"getQuestionHeader",value:function(e,t){var i=this,a=this.state.active[t];return n.a.createElement(j,{title:e,onClick:function(e){return i.onListItemClick(t)},active:a,index:t})}},{key:"getStepOne",value:function(){var e=this.getQuestionHeader("SafeGraph Patterns",0);return this.state.active[0]?n.a.createElement(n.a.Fragment,null,e,n.a.createElement("div",{className:"question-content"},n.a.createElement(U,{active:this.state.explore,onClick:this._onExploreClick,value:this.state.time,onSlide:this._onTimeSlide,text:this.state.selText}))):e}},{key:"getStepTwo",value:function(){var e=this.getQuestionHeader("With Tapestry Segments",1);return this.state.active[1]?n.a.createElement(n.a.Fragment,null,e,n.a.createElement("div",{className:"question-content"},n.a.createElement(ee,{lyr:this.blockLyr,lyrView:this.blockLyrView,mapView:this.mapView,time:this.state.time/4,poi:this.state.selPoi}))):e}},{key:"render",value:function(){return n.a.createElement("div",null,n.a.createElement(E,{map:this.map,onLoad:this.onViewLoad,active:this.state.active,explore:this.state.explore,time:this.state.time/4,poi:this.state.selPoi,onPoiChange:this._onPoiChange}),n.a.createElement("div",{style:{position:"absolute",top:15,left:15,width:"30%",maxHeight:"calc(100vh - 20px)",overflowY:"scroll"}},n.a.createElement("div",{style:{}},this.getStepOne(),this.getStepTwo())))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ae=i(38),ne=i.n(ae);i(243);Object(v.loadCss)("https://jsdev.arcgis.com/4.11/esri/themes/dark/main.css"),$.b.global.defaultFontColor="#ffffff",$.b.global.legend=!1,$.b.global.tooltips.enabled=!1,$.b.global.events=["click","touchstart","touchend"],l.a.render(n.a.createElement(ne.a,null,n.a.createElement(ie,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},61:function(e,t,i){},91:function(e,t,i){e.exports=i(244)}},[[91,1,2]]]);
//# sourceMappingURL=main.b800cd40.chunk.js.map